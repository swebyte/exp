import{a as se}from"./chunk-IYCZIFL5.js";import{e as Q,h as le}from"./chunk-7WLL75XW.js";import{A as ne,B as re,k as y,m as F,r as c,s as K,u as X,v as Z,w as ee,x as te,y as oe,z as ie}from"./chunk-HGW3F55W.js";import{Ab as J,Bb as k,D as P,Jb as f,Lb as m,Mb as v,Na as a,Nb as G,Pb as N,Qb as D,Rb as T,Sb as Y,T as C,Y as M,a as p,ab as B,ac as U,b as g,ba as d,cc as w,ga as q,ha as j,kb as I,lb as x,m as h,oa as u,ob as W,pb as l,q as _,qb as s,rb as $,sb as E,tb as V,ub as z,vb as R,wb as H,ya as S,zb as b}from"./chunk-ZTWUCJV6.js";var L=class n{http=d(F);_posts=u([]);_selectedPost=u(null);posts=U(()=>this._posts());selectedPost=U(()=>this._selectedPost());loadBlogPosts(){this.http.get(`${c.apiBaseUrl}/blog?order=created_at.desc&select=*,users(fullname)`).pipe(_(t=>t.map(e=>g(p({},e),{author:e.users?.fullname||"Unknown Author"}))),P(t=>(console.error("Failed to load blog posts:",t),h([])))).subscribe(t=>this._posts.set(t))}loadBlogPost(t){return this.http.get(`${c.apiBaseUrl}/blog?id=eq.${t}&select=*,users(fullname)`).pipe(_(e=>{if(e.length>0){let o=e[0];return o.author=o.users?.fullname||"Unknown Author",o}return null}),C(e=>this._selectedPost.set(e)),P(e=>(console.error("Failed to load blog post:",e),this._selectedPost.set(null),h(null))))}deleteBlogPost(t){return this.http.delete(`${c.apiBaseUrl}/blog?id=eq.${t}`)}incrementBlogLikes(t){return this.http.post(`${c.apiBaseUrl}/rpc/inc_blog_likes`,{blog_id:t}).pipe(_(e=>e&&e.length>0?e[0].likes:null),C(e=>{if(e==null)return;this._posts.update(i=>i.map(r=>r.id===t?g(p({},r),{likes:e}):r));let o=this._selectedPost();o&&o.id===t&&this._selectedPost.set(g(p({},o),{likes:e}))}),P(e=>(console.error("Failed to increment likes:",e),h(null))))}decrementBlogLikes(t){return this.http.post(`${c.apiBaseUrl}/rpc/dec_blog_likes`,{blog_id:t}).pipe(_(e=>e&&e.length>0?e[0].likes:null),C(e=>{if(e==null)return;this._posts.update(i=>i.map(r=>r.id===t?g(p({},r),{likes:e}):r));let o=this._selectedPost();o&&o.id===t&&this._selectedPost.set(g(p({},o),{likes:e}))}),P(e=>(console.error("Failed to decrement likes:",e),h(null))))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"})};var O=class n{blogService=d(L);platformId=d(S);likedPostsStore=u(new Set);constructor(){this.loadLikedPostsFromStorage()}loadLikedPostsFromStorage(){if(y(this.platformId)){let t=localStorage.getItem("likedPosts");if(t){let e=JSON.parse(t);this.likedPostsStore.set(new Set(e))}}}saveLikedPostsToStorage(){if(y(this.platformId)){let t=Array.from(this.likedPostsStore());localStorage.setItem("likedPosts",JSON.stringify(t))}}isPostLiked(t){return this.likedPostsStore().has(t)}toggleLike(t){let e=new Set(this.likedPostsStore());return e.has(t)?(e.delete(t),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.decrementBlogLikes(t).subscribe({next:i=>{console.log("Likes decremented on server, new count:",i)},error:i=>{console.error("Failed to decrement likes:",i)}}),{liked:!1}):(e.add(t),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.incrementBlogLikes(t).subscribe({next:i=>{console.log("Likes incremented on server, new count:",i)},error:i=>{console.error("Failed to increment likes:",i)}}),{liked:!0})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"})};var ae=class n{likesService=d(O);postId=w.required();count=w.required();readonly=w(!1);liked=u(!1);ngOnInit(){this.liked.set(this.likesService.isPostLiked(this.postId()))}toggleLike(){if(this.readonly())return;let t=this.likesService.toggleLike(this.postId());this.liked.set(t.liked)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=B({type:n,selectors:[["app-like-button"]],inputs:{postId:[1,"postId"],count:[1,"count"],readonly:[1,"readonly"]},decls:4,vars:10,consts:[[1,"like-button",3,"click","title","disabled"],[1,"bi"],[1,"likes-count"]],template:function(e,o){e&1&&(E(0,"button",0),J("click",function(){return o.toggleLike()}),z(1,"i",1),E(2,"span",2),m(3),V()()),e&2&&(f("animated",!o.readonly()),H("title",Y("",o.liked()?"Unlike":"Like"," this post"))("disabled",o.readonly()),a(),f("bi-heart-fill",o.liked())("bi-heart",!o.liked()),a(2),v(o.count()))},styles:[".like-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;display:flex;align-items:center;gap:.5rem;color:#dc3545;font-size:1.25rem}.like-button.animated[_ngcontent-%COMP%]{transition:transform .2s ease}.like-button.animated[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.like-button.animated[_ngcontent-%COMP%]:active{transform:scale(.95)}.like-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}.like-button[_ngcontent-%COMP%]   .likes-count[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#6c757d}"]})};function ce(n,t){if(n&1&&(l(0,"div",4),m(1),s()),n&2){let e=k();a(),v(e.errorMessage)}}function pe(n,t){if(n&1){let e=R();l(0,"textarea",18),T("ngModelChange",function(i){q(e);let r=k();return D(r.body,i)||(r.body=i),j(i)}),s()}if(n&2){let e=k();N("ngModel",e.body)}}function ge(n,t){if(n&1&&(l(0,"div",14),$(1,"markdown",19),s()),n&2){let e=k();a(),W("data",e.body||"*No content yet*")}}var de=class n{activeModal=d(le);platformId=d(S);isBrowser=y(this.platformId);http=d(F);authService=d(K);blogPost;title="";body="";errorMessage="";showPreview=!1;get isEditMode(){return!!this.blogPost}ngOnInit(){this.blogPost&&(this.title=this.blogPost.title,this.body=this.blogPost.body)}onImageUploaded(t){let e=`
<img src="${t}" alt="Image" width="600">
`;this.body=this.body+e}onSubmit(){let t=this.authService.getUserId();if(!t){this.errorMessage="You must be logged in to create/edit posts";return}let e={title:this.title,body:this.body};if(this.isEditMode&&this.blogPost)this.http.patch(`${c.apiBaseUrl}/blog?id=eq.${this.blogPost.id}`,e).subscribe({next:o=>{console.log("Blog post updated:",o),this.activeModal.close(o)},error:o=>{console.error("Failed to update blog post:",o),this.errorMessage="Failed to update blog post. Please try again."}});else{let o=g(p({},e),{user_id:t});this.http.post(`${c.apiBaseUrl}/blog`,o).subscribe({next:i=>{console.log("Blog post created:",i),this.activeModal.close(i)},error:i=>{console.error("Failed to create blog post:",i),this.errorMessage="Failed to create blog post. Please try again."}})}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=B({type:n,selectors:[["app-blog-form"]],inputs:{blogPost:"blogPost"},decls:27,vars:13,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"alert","alert-danger"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","name","title","placeholder","Enter blog post title","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","body",1,"form-label"],[3,"imageUploaded"],[1,"d-flex","gap-2","mb-2"],["type","button",1,"btn","btn-sm",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModel"],[1,"border","rounded","p-3",2,"min-height","400px","background-color","#fff"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"data"]],template:function(e,o){e&1&&(l(0,"div",0)(1,"h5",1),m(2),s(),l(3,"button",2),b("click",function(){return o.activeModal.dismiss()}),s()(),l(4,"div",3),I(5,ce,2,1,"div",4),l(6,"form",5),b("ngSubmit",function(){return o.onSubmit()}),l(7,"div",6)(8,"label",7),m(9,"Title"),s(),l(10,"input",8),T("ngModelChange",function(r){return D(o.title,r)||(o.title=r),r}),s()(),l(11,"div",6)(12,"label",9),m(13,"Content (Markdown supported)"),s(),l(14,"app-image-upload",10),b("imageUploaded",function(r){return o.onImageUploaded(r)}),s(),l(15,"div",11)(16,"button",12),b("click",function(){return o.showPreview=!1}),m(17," Edit "),s(),l(18,"button",12),b("click",function(){return o.showPreview=!0}),m(19," Preview "),s()(),I(20,pe,1,1,"textarea",13)(21,ge,2,1,"div",14),s(),l(22,"div",15)(23,"button",16),m(24),s(),l(25,"button",17),b("click",function(){return o.activeModal.dismiss()}),m(26," Cancel "),s()()()()),e&2&&(a(2),v(o.isEditMode?"Edit Blog Post":"New Blog Post"),a(3),x(o.errorMessage?5:-1),a(5),N("ngModel",o.title),a(6),f("btn-primary",!o.showPreview)("btn-outline-primary",o.showPreview),a(2),f("btn-primary",o.showPreview)("btn-outline-primary",!o.showPreview),a(2),x(o.showPreview?21:20),a(4),G(" ",o.isEditMode?"Update Post":"Publish"," "))},dependencies:[re,ie,X,Z,ee,ne,oe,te,Q,se],styles:[".modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{font-weight:600}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #007bff40}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:200px}"]})};export{L as a,ae as b,de as c};
