import{a as G,b as K}from"./chunk-BC2DD4N7.js";import{a as R,c as q}from"./chunk-KPFTI54D.js";import"./chunk-W3XN5HZT.js";import{e as U,i as $}from"./chunk-RYWR7QYE.js";import{f as V,k as O,m as _,r as H,s as J}from"./chunk-DU5L4OSH.js";import{Ab as T,Bb as m,Jb as F,Lb as c,Mb as C,Na as l,Nb as x,Sb as z,Wb as A,Xb as j,Y as L,ab as u,ba as n,cc as y,ga as P,ha as M,kb as b,lb as k,oa as d,ob as S,pb as s,qb as r,rb as p,sb as B,tb as D,ub as I,vb as E,wb as N,ya as w,zb as f}from"./chunk-ZTWUCJV6.js";var v=class i{http=n(_);platformId=n(w);likedPostsStore=d(new Set);constructor(){this.loadLikedPostsFromStorage()}loadLikedPostsFromStorage(){if(O(this.platformId)){let e=localStorage.getItem("likedPosts");if(e){let t=JSON.parse(e);this.likedPostsStore.set(new Set(t))}}}saveLikedPostsToStorage(){if(O(this.platformId)){let e=Array.from(this.likedPostsStore());localStorage.setItem("likedPosts",JSON.stringify(e))}}isPostLiked(e){return this.likedPostsStore().has(e)}toggleLike(e,t){let o=new Set(this.likedPostsStore()),a=o.has(e),g;return a?(o.delete(e),g=Math.max(0,t-1)):(o.add(e),g=t+1),this.likedPostsStore.set(o),this.saveLikedPostsToStorage(),this.updateLikesOnServer(e,g),{liked:!a,newCount:g}}updateLikesOnServer(e,t){this.http.patch(`${H.apiBaseUrl}/blog?id=eq.${e}`,{likes:t}).subscribe({next:()=>{console.log("Likes updated on server")},error:o=>{console.error("Failed to update likes:",o)}})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=L({token:i,factory:i.\u0275fac,providedIn:"root"})};var h=class i{likesService=n(v);postId=y.required();initialLikesCount=y.required();liked=d(!1);likesCount=d(0);ngOnInit(){this.likesCount.set(this.initialLikesCount()),this.liked.set(this.likesService.isPostLiked(this.postId()))}toggleLike(){let e=this.likesService.toggleLike(this.postId(),this.likesCount());this.liked.set(e.liked),this.likesCount.set(e.newCount)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=u({type:i,selectors:[["app-like-button"]],inputs:{postId:[1,"postId"],initialLikesCount:[1,"initialLikesCount"]},decls:4,vars:7,consts:[[1,"like-button",3,"click","title"],[1,"bi"],[1,"likes-count"]],template:function(t,o){t&1&&(B(0,"button",0),T("click",function(){return o.toggleLike()}),I(1,"i",1),B(2,"span",2),c(3),D()()),t&2&&(N("title",z("",o.liked()?"Unlike":"Like"," this post")),l(),F("bi-heart-fill",o.liked())("bi-heart",!o.liked()),l(2),C(o.likesCount()))},styles:[".like-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;display:flex;align-items:center;gap:.5rem;color:#dc3545;font-size:1.25rem;transition:transform .2s ease}.like-button[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.like-button[_ngcontent-%COMP%]:active{transform:scale(.95)}.like-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}.like-button[_ngcontent-%COMP%]   .likes-count[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#6c757d}"]})};function Y(i,e){i&1&&(s(0,"div",5)(1,"div",7)(2,"span",8),c(3,"Loading..."),r()()())}function Z(i,e){if(i&1){let t=E();s(0,"div",11)(1,"button",16),f("click",function(){P(t);let a=m(2);return M(a.openEditBlogModal())}),p(2,"i",17),r(),s(3,"button",18),f("click",function(){P(t);let a=m(2);return M(a.deleteBlogPost())}),p(4,"i",19),r()()}}function tt(i,e){if(i&1&&c(0),i&2){let t=m(2);x(" By ",t.post().author," \u2022 ")}}function et(i,e){if(i&1&&(s(0,"article",6)(1,"div",9)(2,"h1",10),c(3),r(),b(4,Z,5,0,"div",11),r(),s(5,"div",1)(6,"p",12),b(7,tt,1,1),c(8),A(9,"date"),r(),p(10,"app-like-button",13),r(),s(11,"div",14),p(12,"markdown",15),r()()),i&2){let t=m();l(3),C(t.post().title),l(),k(t.authService.isAuthenticated()?4:-1),l(3),k(t.post().author?7:-1),l(),x(" ",j(9,7,t.post().created_at,"MMMM d, yyyy")," "),l(2),S("postId",t.post().id)("initialLikesCount",t.post().likes||0),l(2),S("data",t.post().body)}}var W=class i{http=n(_);blogService=n(K);route=n(R);router=n(q);modalService=n($);authService=n(J);post=d(null);loading=d(!0);ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e?this.loadBlogPost(Number(e)):this.router.navigate(["/blog/"])}loadBlogPost(e){this.loading.set(!0),this.blogService.getBlogPost(e).subscribe({next:t=>{t?this.post.set(t):(console.error("Blog post not found"),this.router.navigate(["/blog/"])),this.loading.set(!1)},error:t=>{console.error("Failed to load blog post:",t),this.loading.set(!1),this.router.navigate(["/blog/"])}})}deleteBlogPost(){let e=this.post()?.id;e&&confirm("Are you sure you want to delete this post?")&&this.blogService.deleteBlogPost(e).subscribe({next:()=>{console.log("Blog post deleted"),this.router.navigate(["/blog/"])},error:t=>{console.error("Failed to delete blog post:",t)}})}openEditBlogModal(){let e=this.post();if(!e)return;let t=this.modalService.open(G,{centered:!0,size:"lg"});t.componentInstance.blogPost=e,t.result.then(o=>{console.log("Blog post updated:",o),this.loadBlogPost(e.id)},o=>{console.log("Modal dismissed")})}goBack(){this.router.navigate(["/blog/"])}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=u({type:i,selectors:[["app-blog-detail"]],decls:9,vars:1,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"btn","btn-link","ps-0",3,"click"],[1,"bi","bi-arrow-left"],[1,"blog-detail-container"],[1,"text-center"],[1,"blog-post"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"post-title"],[1,"d-flex","gap-1"],[1,"post-date","text-muted","mb-0"],[3,"postId","initialLikesCount"],[1,"post-body"],[3,"data"],["title","Edit post",1,"btn","btn-link","text-primary",3,"click"],[1,"bi","bi-pencil"],["title","Delete post",1,"btn","btn-link","text-danger","delete-btn",3,"click"],[1,"bi","bi-trash"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"div",1)(2,"div")(3,"button",2),f("click",function(){return o.goBack()}),p(4,"i",3),c(5," Back "),r()()(),s(6,"div",4),b(7,Y,4,0,"div",5)(8,et,13,10,"article",6),r()()),t&2&&(l(7),k(o.loading()?7:o.post()?8:-1))},dependencies:[U,h,V],styles:[".blog-detail-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .post-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#212529;margin-bottom:.5rem}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .post-date[_ngcontent-%COMP%]{font-size:1rem}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .post-body[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.8;color:#495057;white-space:pre-wrap;word-wrap:break-word}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;opacity:.6;transition:opacity .2s}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]:hover{opacity:1}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.blog-detail-container[_ngcontent-%COMP%]   .spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem;margin-top:3rem}"]})};export{W as BlogDetailComponent};
