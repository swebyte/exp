import{g as T,l as j,m as V,r as D}from"./chunk-ELE5WUPD.js";import{Ab as f,Bb as k,Ib as F,Lb as g,Mb as H,Na as a,Nb as M,Sa as _,Y as v,Ya as C,aa as h,ab as U,f as b,ga as c,ha as u,kb as y,lb as E,sb as p,tb as l,ub as w,vb as x,wb as S}from"./chunk-ZTWUCJV6.js";var s=class n{constructor(i){this.http=i}apiUrl=D.apiBaseUrl;uploadImage(i){return new b(e=>{let t=new FileReader;t.onload=()=>{let o=t.result.split(",")[1],m=localStorage.getItem("token"),r=new j({Authorization:`Bearer ${m}`,"Content-Type":"application/json",Prefer:"return=representation"});this.http.post(`${this.apiUrl}/rpc/upload_file`,{base64_data:o,file_type:i.type,file_name:i.name},{headers:r}).subscribe({next:d=>{let I=d.id,O=`${this.apiUrl}/rpc/file?file_id=${I}`;e.next({id:I,url:O}),e.complete()},error:d=>e.error(d)})},t.onerror=o=>e.error(o),t.readAsDataURL(i)})}static \u0275fac=function(e){return new(e||n)(h(V))};static \u0275prov=v({token:n,factory:n.\u0275fac,providedIn:"root"})};function z(n,i){if(n&1&&(p(0,"small",5),g(1),l()),n&2){let e=k();a(),H(e.error)}}var L=class n{constructor(i){this.imageService=i}imageUploaded=new _;uploading=!1;error=null;onFileSelected(i){let e=i.target;if(e.files&&e.files[0]){let t=e.files[0];if(t.size>10*1024*1024){this.error="File size must be less than 10MB";return}this.uploading=!0,this.error=null,this.imageService.uploadImage(t).subscribe({next:o=>{this.imageUploaded.emit(o.url),this.uploading=!1,this.error=null,e.value=""},error:o=>{this.error="Upload failed",this.uploading=!1}})}}static \u0275fac=function(e){return new(e||n)(C(s))};static \u0275cmp=U({type:n,selectors:[["app-image-upload"]],outputs:{imageUploaded:"imageUploaded"},decls:7,vars:3,consts:[["fileInput",""],[1,"image-upload","mb-2"],["type","file","accept","image/*",3,"change"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click","disabled"],[1,"bi","bi-image"],[1,"error","text-danger","ms-2"]],template:function(e,t){if(e&1){let o=x();p(0,"div",1)(1,"input",2,0),f("change",function(r){return c(o),u(t.onFileSelected(r))}),l(),p(3,"button",3),f("click",function(){c(o);let r=F(2);return u(r.click())}),w(4,"i",4),g(5),l(),y(6,z,2,1,"small",5),l()}e&2&&(a(3),S("disabled",t.uploading),a(2),M(" ",t.uploading?"Uploading...":"Upload Image"," "),a(),E(t.error?6:-1))},dependencies:[T],styles:["input[type=file][_ngcontent-%COMP%]{display:none}"]})};export{L as a};
