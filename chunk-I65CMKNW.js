import{a as se}from"./chunk-SJQ2B3S3.js";import{e as Q,h as le}from"./chunk-STM5T3Q6.js";import{A as ne,B as ie,C as re,l as M,n as F,s as c,t as K,v as X,w as Z,x as ee,y as te,z as oe}from"./chunk-6RF4LEQF.js";import{Cb as u,D as _,Db as H,Eb as v,Mb as P,Na as d,Ob as m,Pb as y,Qb as J,Sb as N,T as C,Tb as D,Ub as T,Vb as Y,Y as S,a as p,ab as w,b as g,ba as a,ec as A,ga as q,gc as I,ha as $,lb as O,m as b,mb as x,oa as f,pb as j,q as h,qb as r,rb as s,sb as W,tb as E,ub as V,vb as G,ya as B,yb as z,zb as R}from"./chunk-6ZM7RP27.js";var k=class i{http=a(F);_posts=f([]);_selectedPost=f(null);posts=A(()=>this._posts());selectedPost=A(()=>this._selectedPost());loadBlogPosts(){this.http.get(`${c.apiBaseUrl}/blog?order=created_at.desc&select=*,users(fullname)`).pipe(h(t=>t.map(e=>g(p({},e),{author:e.users?.fullname||"Unknown Author"}))),_(t=>(console.error("Failed to load blog posts:",t),b([])))).subscribe(t=>this._posts.set(t))}loadBlogPost(t){return this.http.get(`${c.apiBaseUrl}/blog?id=eq.${t}&select=*,users(fullname)`).pipe(h(e=>{if(e.length>0){let o=e[0];return o.author=o.users?.fullname||"Unknown Author",o}return null}),C(e=>this._selectedPost.set(e)),_(e=>(console.error("Failed to load blog post:",e),this._selectedPost.set(null),b(null))))}deleteBlogPost(t){return this.http.delete(`${c.apiBaseUrl}/blog?id=eq.${t}`)}incrementBlogLikes(t){return this.http.post(`${c.apiBaseUrl}/rpc/inc_blog_likes`,{blog_id:t}).pipe(h(e=>e&&e.length>0?e[0].likes:null),C(e=>{if(e==null)return;this._posts.update(n=>n.map(l=>l.id===t?g(p({},l),{likes:e}):l));let o=this._selectedPost();o&&o.id===t&&this._selectedPost.set(g(p({},o),{likes:e}))}),_(e=>(console.error("Failed to increment likes:",e),b(null))))}decrementBlogLikes(t){return this.http.post(`${c.apiBaseUrl}/rpc/dec_blog_likes`,{blog_id:t}).pipe(h(e=>e&&e.length>0?e[0].likes:null),C(e=>{if(e==null)return;this._posts.update(n=>n.map(l=>l.id===t?g(p({},l),{likes:e}):l));let o=this._selectedPost();o&&o.id===t&&this._selectedPost.set(g(p({},o),{likes:e}))}),_(e=>(console.error("Failed to decrement likes:",e),b(null))))}generateAI(t){return t?this.http.post(`${c.apiBaseUrl}/b2/ask`,{text:t}).pipe(h(e=>e&&e.result?e.result:null),_(e=>(console.error("AI generation failed:",e),b(null)))):b(null)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"})};var L=class i{blogService=a(k);platformId=a(B);likedPostsStore=f(new Set);constructor(){this.loadLikedPostsFromStorage()}loadLikedPostsFromStorage(){if(M(this.platformId)){let t=localStorage.getItem("likedPosts");if(t){let e=JSON.parse(t);this.likedPostsStore.set(new Set(e))}}}saveLikedPostsToStorage(){if(M(this.platformId)){let t=Array.from(this.likedPostsStore());localStorage.setItem("likedPosts",JSON.stringify(t))}}isPostLiked(t){return this.likedPostsStore().has(t)}toggleLike(t){let e=new Set(this.likedPostsStore());return e.has(t)?(e.delete(t),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.decrementBlogLikes(t).subscribe({next:n=>{console.log("Likes decremented on server, new count:",n)},error:n=>{console.error("Failed to decrement likes:",n)}}),{liked:!1}):(e.add(t),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.incrementBlogLikes(t).subscribe({next:n=>{console.log("Likes incremented on server, new count:",n)},error:n=>{console.error("Failed to increment likes:",n)}}),{liked:!0})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"})};var ae=class i{likesService=a(L);postId=I.required();count=I.required();readonly=I(!1);liked=f(!1);ngOnInit(){this.liked.set(this.likesService.isPostLiked(this.postId()))}toggleLike(){if(this.readonly())return;let t=this.likesService.toggleLike(this.postId());this.liked.set(t.liked)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-like-button"]],inputs:{postId:[1,"postId"],count:[1,"count"],readonly:[1,"readonly"]},decls:4,vars:10,consts:[[1,"like-button",3,"click","title","disabled"],[1,"bi"],[1,"likes-count"]],template:function(e,o){e&1&&(E(0,"button",0),H("click",function(){return o.toggleLike()}),G(1,"i",1),E(2,"span",2),m(3),V()()),e&2&&(P("animated",!o.readonly()),R("title",Y("",o.liked()?"Unlike":"Like"," this post"))("disabled",o.readonly()),d(),P("bi-heart-fill",o.liked())("bi-heart",!o.liked()),d(2),y(o.count()))},styles:[".like-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;display:flex;align-items:center;gap:.5rem;color:#dc3545;font-size:1.25rem}.like-button.animated[_ngcontent-%COMP%]{transition:transform .2s ease}.like-button.animated[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.like-button.animated[_ngcontent-%COMP%]:active{transform:scale(.95)}.like-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}.like-button[_ngcontent-%COMP%]   .likes-count[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#6c757d}"]})};function ce(i,t){if(i&1&&(r(0,"div",4),m(1),s()),i&2){let e=v();d(),y(e.errorMessage)}}function pe(i,t){if(i&1){let e=z();r(0,"textarea",19),T("ngModelChange",function(n){q(e);let l=v();return D(l.body,n)||(l.body=n),$(n)}),s()}if(i&2){let e=v();N("ngModel",e.body)}}function ge(i,t){if(i&1&&(r(0,"div",15),W(1,"markdown",20),s()),i&2){let e=v();d(),j("data",e.body||"*No content yet*")}}var de=class i{activeModal=a(le);platformId=a(B);isBrowser=M(this.platformId);http=a(F);authService=a(K);blogService=a(k);blogPost;title="";body="";errorMessage="";showPreview=!1;get isEditMode(){return!!this.blogPost}ngOnInit(){this.blogPost&&(this.title=this.blogPost.title,this.body=this.blogPost.body)}onImageUploaded(t){let e=`
<img src="${t}" alt="Image" width="600">
`;this.body=this.body+e}onAIGenerate(){let t=`Make my blog post better and correct grammar:

${this.body}

`;this.blogService.generateAI(t).subscribe(e=>{e?this.body=this.body+`

`+e:this.errorMessage="AI generation failed. Please try again."})}onSubmit(){let t=this.authService.getUserId();if(!t){this.errorMessage="You must be logged in to create/edit posts";return}let e={title:this.title,body:this.body};if(this.isEditMode&&this.blogPost)this.http.patch(`${c.apiBaseUrl}/blog?id=eq.${this.blogPost.id}`,e).subscribe({next:o=>{console.log("Blog post updated:",o),this.activeModal.close(o)},error:o=>{console.error("Failed to update blog post:",o),this.errorMessage="Failed to update blog post. Please try again."}});else{let o=g(p({},e),{user_id:t});this.http.post(`${c.apiBaseUrl}/blog`,o).subscribe({next:n=>{console.log("Blog post created:",n),this.activeModal.close(n)},error:n=>{console.error("Failed to create blog post:",n),this.errorMessage="Failed to create blog post. Please try again."}})}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-blog-form"]],inputs:{blogPost:"blogPost"},decls:29,vars:13,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"alert","alert-danger"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","name","title","placeholder","Enter blog post title","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","body",1,"form-label"],[3,"imageUploaded"],[1,"d-flex","gap-2","mb-2"],["type","button",1,"btn","btn-sm",3,"click"],["type","button","title","Generate content with AI","aria-label","Generate content with AI",1,"btn","btn-sm","btn-outline-secondary",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModel"],[1,"border","rounded","p-3",2,"min-height","400px","background-color","#fff"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"data"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"h5",1),m(2),s(),r(3,"button",2),u("click",function(){return o.activeModal.dismiss()}),s()(),r(4,"div",3),O(5,ce,2,1,"div",4),r(6,"form",5),u("ngSubmit",function(){return o.onSubmit()}),r(7,"div",6)(8,"label",7),m(9,"Title"),s(),r(10,"input",8),T("ngModelChange",function(l){return D(o.title,l)||(o.title=l),l}),s()(),r(11,"div",6)(12,"label",9),m(13,"Content (Markdown supported)"),s(),r(14,"app-image-upload",10),u("imageUploaded",function(l){return o.onImageUploaded(l)}),s(),r(15,"div",11)(16,"button",12),u("click",function(){return o.showPreview=!1}),m(17," Edit "),s(),r(18,"button",12),u("click",function(){return o.showPreview=!0}),m(19," Preview "),s(),r(20,"button",13),u("click",function(){return o.onAIGenerate()}),m(21," AI "),s()(),O(22,pe,1,1,"textarea",14)(23,ge,2,1,"div",15),s(),r(24,"div",16)(25,"button",17),m(26),s(),r(27,"button",18),u("click",function(){return o.activeModal.dismiss()}),m(28," Cancel "),s()()()()),e&2&&(d(2),y(o.isEditMode?"Edit Blog Post":"New Blog Post"),d(3),x(o.errorMessage?5:-1),d(5),N("ngModel",o.title),d(6),P("btn-primary",!o.showPreview)("btn-outline-primary",o.showPreview),d(2),P("btn-primary",o.showPreview)("btn-outline-primary",!o.showPreview),d(4),x(o.showPreview?23:22),d(4),J(" ",o.isEditMode?"Update Post":"Publish"," "))},dependencies:[re,ne,X,Z,ee,ie,oe,te,Q,se],styles:[".modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{font-weight:600}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #007bff40}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:200px}"]})};export{k as a,ae as b,de as c};
