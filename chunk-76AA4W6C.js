import{a as de}from"./chunk-SJQ2B3S3.js";import{e as Z,h as ae}from"./chunk-STM5T3Q6.js";import{A as re,B as le,C as se,l as M,n as F,s as c,t as X,v as ee,w as te,x as oe,y as ie,z as ne}from"./chunk-6RF4LEQF.js";import{Cb as u,D as _,Db as Y,Eb as v,K as j,Mb as P,Na as a,Ob as m,Pb as y,Qb as K,Sb as T,T as C,Tb as A,Ub as U,Vb as Q,Y as S,a as p,ab as w,b as g,ba as d,ec as q,ga as W,gc as L,ha as V,kb as z,lb as E,m as b,mb as x,oa as f,pb as I,q as h,qb as r,rb as s,sb as N,tb as D,ub as G,vb as R,ya as B,yb as H,zb as J}from"./chunk-6ZM7RP27.js";var k=class n{http=d(F);_posts=f([]);_selectedPost=f(null);posts=q(()=>this._posts());selectedPost=q(()=>this._selectedPost());loadBlogPosts(){this.http.get(`${c.apiBaseUrl}/blog?order=created_at.desc&select=*,users(fullname)`).pipe(h(t=>t.map(e=>g(p({},e),{author:e.users?.fullname||"Unknown Author"}))),_(t=>(console.error("Failed to load blog posts:",t),b([])))).subscribe(t=>this._posts.set(t))}loadBlogPost(t){return this.http.get(`${c.apiBaseUrl}/blog?id=eq.${t}&select=*,users(fullname)`).pipe(h(e=>{if(e.length>0){let o=e[0];return o.author=o.users?.fullname||"Unknown Author",o}return null}),C(e=>this._selectedPost.set(e)),_(e=>(console.error("Failed to load blog post:",e),this._selectedPost.set(null),b(null))))}deleteBlogPost(t){return this.http.delete(`${c.apiBaseUrl}/blog?id=eq.${t}`)}incrementBlogLikes(t){return this.http.post(`${c.apiBaseUrl}/rpc/inc_blog_likes`,{blog_id:t}).pipe(h(e=>e&&e.length>0?e[0].likes:null),C(e=>{if(e==null)return;this._posts.update(i=>i.map(l=>l.id===t?g(p({},l),{likes:e}):l));let o=this._selectedPost();o&&o.id===t&&this._selectedPost.set(g(p({},o),{likes:e}))}),_(e=>(console.error("Failed to increment likes:",e),b(null))))}decrementBlogLikes(t){return this.http.post(`${c.apiBaseUrl}/rpc/dec_blog_likes`,{blog_id:t}).pipe(h(e=>e&&e.length>0?e[0].likes:null),C(e=>{if(e==null)return;this._posts.update(i=>i.map(l=>l.id===t?g(p({},l),{likes:e}):l));let o=this._selectedPost();o&&o.id===t&&this._selectedPost.set(g(p({},o),{likes:e}))}),_(e=>(console.error("Failed to decrement likes:",e),b(null))))}generateAI(t){return t?this.http.post(`${c.apiBaseUrl}/b2/ask`,{message:t}).pipe(h(e=>e&&e.result?e.result:null),_(e=>(console.error("AI generation failed:",e),b(null)))):b(null)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=S({token:n,factory:n.\u0275fac,providedIn:"root"})};var O=class n{blogService=d(k);platformId=d(B);likedPostsStore=f(new Set);constructor(){this.loadLikedPostsFromStorage()}loadLikedPostsFromStorage(){if(M(this.platformId)){let t=localStorage.getItem("likedPosts");if(t){let e=JSON.parse(t);this.likedPostsStore.set(new Set(e))}}}saveLikedPostsToStorage(){if(M(this.platformId)){let t=Array.from(this.likedPostsStore());localStorage.setItem("likedPosts",JSON.stringify(t))}}isPostLiked(t){return this.likedPostsStore().has(t)}toggleLike(t){let e=new Set(this.likedPostsStore());return e.has(t)?(e.delete(t),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.decrementBlogLikes(t).subscribe({next:i=>{console.log("Likes decremented on server, new count:",i)},error:i=>{console.error("Failed to decrement likes:",i)}}),{liked:!1}):(e.add(t),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.incrementBlogLikes(t).subscribe({next:i=>{console.log("Likes incremented on server, new count:",i)},error:i=>{console.error("Failed to increment likes:",i)}}),{liked:!0})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=S({token:n,factory:n.\u0275fac,providedIn:"root"})};var me=class n{likesService=d(O);postId=L.required();count=L.required();readonly=L(!1);liked=f(!1);ngOnInit(){this.liked.set(this.likesService.isPostLiked(this.postId()))}toggleLike(){if(this.readonly())return;let t=this.likesService.toggleLike(this.postId());this.liked.set(t.liked)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["app-like-button"]],inputs:{postId:[1,"postId"],count:[1,"count"],readonly:[1,"readonly"]},decls:4,vars:10,consts:[[1,"like-button",3,"click","title","disabled"],[1,"bi"],[1,"likes-count"]],template:function(e,o){e&1&&(D(0,"button",0),Y("click",function(){return o.toggleLike()}),R(1,"i",1),D(2,"span",2),m(3),G()()),e&2&&(P("animated",!o.readonly()),J("title",Q("",o.liked()?"Unlike":"Like"," this post"))("disabled",o.readonly()),a(),P("bi-heart-fill",o.liked())("bi-heart",!o.liked()),a(2),y(o.count()))},styles:[".like-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;display:flex;align-items:center;gap:.5rem;color:#dc3545;font-size:1.25rem}.like-button.animated[_ngcontent-%COMP%]{transition:transform .2s ease}.like-button.animated[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.like-button.animated[_ngcontent-%COMP%]:active{transform:scale(.95)}.like-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}.like-button[_ngcontent-%COMP%]   .likes-count[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#6c757d}"]})};function ge(n,t){if(n&1&&(r(0,"div",4),m(1),s()),n&2){let e=v();a(),y(e.errorMessage)}}function ue(n,t){if(n&1){let e=H();r(0,"textarea",20),U("ngModelChange",function(i){W(e);let l=v();return A(l.body,i)||(l.body=i),V(i)}),s()}if(n&2){let e=v();T("ngModel",e.body)}}function be(n,t){if(n&1&&(r(0,"div",16),N(1,"markdown",21),s()),n&2){let e=v();a(),I("data",e.body||"*No content yet*")}}var ce=class n{activeModal=d(ae);platformId=d(B);isBrowser=M(this.platformId);http=d(F);authService=d(X);blogService=d(k);blogPost;title="";body="";errorMessage="";showPreview=!1;aiLoading=!1;get isEditMode(){return!!this.blogPost}ngOnInit(){this.blogPost&&(this.title=this.blogPost.title,this.body=this.blogPost.body)}onImageUploaded(t){let e=`
<img src="${t}" alt="Image" width="600">
`;this.body=this.body+e}onAIGenerate(){this.errorMessage="";let t=`Make my blog post better and correct grammar:

${this.body}

`;this.aiLoading=!0,this.blogService.generateAI(t).pipe(j(()=>this.aiLoading=!1)).subscribe(e=>{e?this.body=this.body+`

`+e:this.errorMessage="AI generation failed. Please try again."})}onSubmit(){let t=this.authService.getUserId();if(!t){this.errorMessage="You must be logged in to create/edit posts";return}let e={title:this.title,body:this.body};if(this.isEditMode&&this.blogPost)this.http.patch(`${c.apiBaseUrl}/blog?id=eq.${this.blogPost.id}`,e).subscribe({next:o=>{console.log("Blog post updated:",o),this.activeModal.close(o)},error:o=>{console.error("Failed to update blog post:",o),this.errorMessage="Failed to update blog post. Please try again."}});else{let o=g(p({},e),{user_id:t});this.http.post(`${c.apiBaseUrl}/blog`,o).subscribe({next:i=>{console.log("Blog post created:",i),this.activeModal.close(i)},error:i=>{console.error("Failed to create blog post:",i),this.errorMessage="Failed to create blog post. Please try again."}})}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["app-blog-form"]],inputs:{blogPost:"blogPost"},decls:30,vars:16,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"alert","alert-danger"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","name","title","placeholder","Enter blog post title","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","body",1,"form-label"],[3,"imageUploaded"],[1,"d-flex","gap-2","mb-2"],["type","button",1,"btn","btn-sm",3,"click"],["type","button","title","Generate content with AI","aria-label","Generate content with AI",1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1",3,"hidden"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModel"],[1,"border","rounded","p-3",2,"min-height","400px","background-color","#fff"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"data"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"h5",1),m(2),s(),r(3,"button",2),u("click",function(){return o.activeModal.dismiss()}),s()(),r(4,"div",3),E(5,ge,2,1,"div",4),r(6,"form",5),u("ngSubmit",function(){return o.onSubmit()}),r(7,"div",6)(8,"label",7),m(9,"Title"),s(),r(10,"input",8),U("ngModelChange",function(l){return A(o.title,l)||(o.title=l),l}),s()(),r(11,"div",6)(12,"label",9),m(13,"Content (Markdown supported)"),s(),r(14,"app-image-upload",10),u("imageUploaded",function(l){return o.onImageUploaded(l)}),s(),r(15,"div",11)(16,"button",12),u("click",function(){return o.showPreview=!1}),m(17," Edit "),s(),r(18,"button",12),u("click",function(){return o.showPreview=!0}),m(19," Preview "),s(),r(20,"button",13),u("click",function(){return o.onAIGenerate()}),N(21,"span",14),m(22," AI "),s()(),E(23,ue,1,1,"textarea",15)(24,be,2,1,"div",16),s(),r(25,"div",17)(26,"button",18),m(27),s(),r(28,"button",19),u("click",function(){return o.activeModal.dismiss()}),m(29," Cancel "),s()()()()),e&2&&(a(2),y(o.isEditMode?"Edit Blog Post":"New Blog Post"),a(3),x(o.errorMessage?5:-1),a(5),T("ngModel",o.title),a(6),P("btn-primary",!o.showPreview)("btn-outline-primary",o.showPreview),a(2),P("btn-primary",o.showPreview)("btn-outline-primary",!o.showPreview),a(2),I("disabled",o.aiLoading),z("aria-busy",o.aiLoading),a(),I("hidden",!o.aiLoading),a(2),x(o.showPreview?24:23),a(4),K(" ",o.isEditMode?"Update Post":"Publish"," "))},dependencies:[se,re,ee,te,oe,le,ne,ie,Z,de],styles:[".modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{font-weight:600}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #007bff40}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:200px}"]})};export{k as a,me as b,ce as c};
