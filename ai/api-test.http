### AI Server API Tests
### Use with REST Client extension in VS Code or IntelliJ IDEA

@baseUrl = http://localhost:3001

###############################################################################
# Health Check
###############################################################################

### 1. Health check
GET {{baseUrl}}/health

###############################################################################
# Database Schema & Query
###############################################################################

### 2. Get database schema
GET {{baseUrl}}/api/schema

### 3. Get schema for specific schema name
GET {{baseUrl}}/api/schema?schema=api

### 4. Execute custom SQL query - Count blog posts
POST {{baseUrl}}/api/query
Content-Type: application/json

{
  "query": "SELECT COUNT(*) as total_posts FROM api.blog"
}

### 5. Execute custom SQL query - Get published posts
POST {{baseUrl}}/api/query
Content-Type: application/json

{
  "query": "SELECT id, title, published FROM api.blog WHERE published = true"
}

### 6. Execute custom SQL query - Get posts by date
POST {{baseUrl}}/api/query
Content-Type: application/json

{
  "query": "SELECT DATE(created_at) as date, COUNT(*) as count FROM api.blog GROUP BY DATE(created_at) ORDER BY date DESC"
}


### 18. Ask AI about database structure
POST {{baseUrl}}/api/ai/chat
Content-Type: application/json

{
  "question": "What tables exist in my database?"
}

### 19. Ask AI how many blog posts
POST {{baseUrl}}/api/ai/chat
Content-Type: application/json

{
  "question": "How many blog posts do I have?"
}

### 20. Ask AI about experience table structure
POST {{baseUrl}}/api/ai/chat
Content-Type: application/json

{
  "question": "What columns does the experience table have?"
}

### 21. Ask AI for query help
POST {{baseUrl}}/api/ai/chat
Content-Type: application/json

{
  "question": "How do I find all published blog posts from 2024?"
}

### 22. Ask AI about users
POST {{baseUrl}}/api/ai/chat
Content-Type: application/json

{
  "question": "How many users are in the database?"
}

### 23. Ask AI general question (without schema context)
POST {{baseUrl}}/api/ai/chat
Content-Type: application/json

{
  "question": "What is PostgreSQL?",
  "includeSchema": false
}

### 24. Ask AI about data relationships
POST {{baseUrl}}/api/ai/chat
Content-Type: application/json

{
  "question": "What is the relationship between blog posts and users?"
}

###############################################################################
# AI Query Data - Generate SQL + Execute + Explain
###############################################################################

### 25. AI: Show published blog posts
POST {{baseUrl}}/api/ai/query-data
Content-Type: application/json

{
  "question": "Show me all published blog posts"
}

### 26. AI: Count users
POST {{baseUrl}}/api/ai/query-data
Content-Type: application/json

{
  "question": "How many users are there?"
}

### 27. AI: Show recent blog posts
POST {{baseUrl}}/api/ai/query-data
Content-Type: application/json

{
  "question": "Show me the 5 most recent blog posts"
}

### 28. AI: Find unpublished posts
POST {{baseUrl}}/api/ai/query-data
Content-Type: application/json

{
  "question": "Show me unpublished blog posts"
}

### 29. AI: Experience from 2023
POST {{baseUrl}}/api/ai/query-data
Content-Type: application/json

{
  "question": "Show me experience entries from 2023"
}

### 30. AI: Blog posts with specific word
POST {{baseUrl}}/api/ai/query-data
Content-Type: application/json

{
  "question": "Find blog posts that mention 'javascript'"
}

### 31. AI: Get user by email
POST {{baseUrl}}/api/ai/query-data
Content-Type: application/json

{
  "question": "Show me the user with email admin@example.com"
}

### 32. AI: Posts grouped by publish status
POST {{baseUrl}}/api/ai/query-data
Content-Type: application/json

{
  "question": "How many published vs unpublished blog posts do I have?"
}

###############################################################################
# Error Cases (for testing error handling)
###############################################################################

### 33. Invalid SQL (should fail - only SELECT allowed)
POST {{baseUrl}}/api/query
Content-Type: application/json

{
  "query": "DELETE FROM api.blog WHERE id = 1"
}

### 34. Missing required field in query
POST {{baseUrl}}/api/query
Content-Type: application/json

{
  "invalid": "field"
}

### 35. Missing question in AI chat
POST {{baseUrl}}/api/ai/chat
Content-Type: application/json

{
  "wrong": "field"
}

### 36. Invalid endpoint (should return 404)
GET {{baseUrl}}/api/invalid-endpoint

###############################################################################
# Complex Queries
###############################################################################

### 37. Join query (if you have user_id in blog)
POST {{baseUrl}}/api/query
Content-Type: application/json

{
  "query": "SELECT b.id, b.title, u.email FROM api.blog b LEFT JOIN api.users u ON b.user_id = u.id LIMIT 5"
}

### 38. Aggregate query
POST {{baseUrl}}/api/query
Content-Type: application/json

{
  "query": "SELECT published, COUNT(*) as count FROM api.blog GROUP BY published"
}

### 39. Date range query
POST {{baseUrl}}/api/query
Content-Type: application/json

{
  "query": "SELECT * FROM api.blog WHERE created_at >= NOW() - INTERVAL '30 days'"
}

###############################################################################
# End of Tests
###############################################################################
