import{a as _,b as G}from"./chunk-25J2SO6Y.js";import{b as V,d as R}from"./chunk-JXR4H37N.js";import"./chunk-SJQ2B3S3.js";import{e as J,i as U}from"./chunk-STM5T3Q6.js";import{g as j,l as O,t as q}from"./chunk-6RF4LEQF.js";import{Cb as f,Db as T,Eb as m,Mb as B,Na as l,Ob as d,Pb as k,Qb as x,Vb as F,Y as w,Zb as z,_b as A,ab as g,ba as r,ga as P,gc as v,ha as M,lb as u,mb as b,oa as c,pb as S,qb as a,rb as s,sb as p,tb as y,ub as D,vb as I,ya as L,yb as E,zb as N}from"./chunk-6ZM7RP27.js";var C=class o{blogService=r(_);platformId=r(L);likedPostsStore=c(new Set);constructor(){this.loadLikedPostsFromStorage()}loadLikedPostsFromStorage(){if(O(this.platformId)){let t=localStorage.getItem("likedPosts");if(t){let e=JSON.parse(t);this.likedPostsStore.set(new Set(e))}}}saveLikedPostsToStorage(){if(O(this.platformId)){let t=Array.from(this.likedPostsStore());localStorage.setItem("likedPosts",JSON.stringify(t))}}isPostLiked(t){return this.likedPostsStore().has(t)}toggleLike(t){let e=new Set(this.likedPostsStore());return e.has(t)?(e.delete(t),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.decrementBlogLikes(t).subscribe({next:i=>{console.log("Likes decremented on server, new count:",i)},error:i=>{console.error("Failed to decrement likes:",i)}}),{liked:!1}):(e.add(t),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.incrementBlogLikes(t).subscribe({next:i=>{console.log("Likes incremented on server, new count:",i)},error:i=>{console.error("Failed to increment likes:",i)}}),{liked:!0})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var h=class o{likesService=r(C);postId=v.required();count=v.required();readonly=v(!1);liked=c(!1);ngOnInit(){this.liked.set(this.likesService.isPostLiked(this.postId()))}toggleLike(){if(this.readonly())return;let t=this.likesService.toggleLike(this.postId());this.liked.set(t.liked)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=g({type:o,selectors:[["app-like-button"]],inputs:{postId:[1,"postId"],count:[1,"count"],readonly:[1,"readonly"]},decls:4,vars:10,consts:[[1,"like-button",3,"click","title","disabled"],[1,"bi"],[1,"likes-count"]],template:function(e,n){e&1&&(y(0,"button",0),T("click",function(){return n.toggleLike()}),I(1,"i",1),y(2,"span",2),d(3),D()()),e&2&&(B("animated",!n.readonly()),N("title",F("",n.liked()?"Unlike":"Like"," this post"))("disabled",n.readonly()),l(),B("bi-heart-fill",n.liked())("bi-heart",!n.liked()),l(2),k(n.count()))},styles:[".like-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;display:flex;align-items:center;gap:.5rem;color:#dc3545;font-size:1.25rem}.like-button.animated[_ngcontent-%COMP%]{transition:transform .2s ease}.like-button.animated[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.like-button.animated[_ngcontent-%COMP%]:active{transform:scale(.95)}.like-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}.like-button[_ngcontent-%COMP%]   .likes-count[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#6c757d}"]})};function W(o,t){o&1&&(a(0,"div",5)(1,"div",7)(2,"span",8),d(3,"Loading..."),s()()())}function X(o,t){if(o&1){let e=E();a(0,"div",11)(1,"button",16),f("click",function(){P(e);let i=m(2);return M(i.openEditBlogModal())}),p(2,"i",17),s(),a(3,"button",18),f("click",function(){P(e);let i=m(2);return M(i.deleteBlogPost())}),p(4,"i",19),s()()}}function Y(o,t){if(o&1&&d(0),o&2){let e=m(2);x(" By ",e.post().author," \u2022 ")}}function Z(o,t){if(o&1&&(a(0,"article",6)(1,"div",9)(2,"h1",10),d(3),s(),u(4,X,5,0,"div",11),s(),a(5,"div",1)(6,"p",12),u(7,Y,1,1),d(8),z(9,"date"),s(),p(10,"app-like-button",13),s(),a(11,"div",14),p(12,"markdown",15),s()()),o&2){let e=m();l(3),k(e.post().title),l(),b(e.authService.isAuthenticated()?4:-1),l(3),b(e.post().author?7:-1),l(),x(" ",A(9,7,e.post().created_at,"MMMM d, yyyy")," "),l(2),S("postId",e.post().id)("count",e.post().likes||0),l(2),S("data",e.post().body)}}var K=class o{blogService=r(_);route=r(V);router=r(R);modalService=r(U);authService=r(q);post=this.blogService.selectedPost;loading=c(!0);ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t?(this.loading.set(!0),this.blogService.loadBlogPost(Number(t)).subscribe({next:e=>{e||(console.error("Blog post not found"),this.router.navigate(["/blog/"])),this.loading.set(!1)},error:e=>{console.error("Failed to load blog post:",e),this.loading.set(!1),this.router.navigate(["/blog/"])}})):this.router.navigate(["/blog/"])}deleteBlogPost(){let t=this.post()?.id;t&&confirm("Are you sure you want to delete this post?")&&this.blogService.deleteBlogPost(t).subscribe({next:()=>{console.log("Blog post deleted"),this.router.navigate(["/blog/"])},error:e=>{console.error("Failed to delete blog post:",e)}})}openEditBlogModal(){let t=this.post();if(!t)return;let e=this.modalService.open(G,{centered:!0,size:"lg"});e.componentInstance.blogPost=t,e.result.then(n=>{console.log("Blog post updated:",n),this.blogService.loadBlogPost(t.id).subscribe()},n=>{console.log("Modal dismissed")})}goBack(){this.router.navigate(["/blog/"])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=g({type:o,selectors:[["app-blog-detail"]],decls:9,vars:1,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"btn","ps-0",3,"click"],[1,"bi","bi-arrow-left","pe-2"],[1,"blog-detail-container"],[1,"text-center"],[1,"blog-post"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"post-title"],[1,"d-flex","gap-1"],[1,"post-date","text-muted","mb-0"],[3,"postId","count"],[1,"post-body"],[3,"data"],["title","Edit post",1,"btn","btn-link","text-primary",3,"click"],[1,"bi","bi-pencil"],["title","Delete post",1,"btn","btn-link","text-danger","delete-btn",3,"click"],[1,"bi","bi-trash"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"button",2),f("click",function(){return n.goBack()}),p(4,"i",3),d(5," Back "),s()()(),a(6,"div",4),u(7,W,4,0,"div",5)(8,Z,13,10,"article",6),s()()),e&2&&(l(7),b(n.loading()?7:n.post()?8:-1))},dependencies:[J,h,j],styles:[".blog-detail-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .post-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#212529;margin-bottom:.5rem}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .post-date[_ngcontent-%COMP%]{font-size:1rem}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .post-body[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.8;color:#495057;white-space:pre-wrap;word-wrap:break-word}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{padding:.25rem .5rem;opacity:.6;transition:opacity .2s}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]:hover{opacity:1}.blog-detail-container[_ngcontent-%COMP%]   .blog-post[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.blog-detail-container[_ngcontent-%COMP%]   .spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem;margin-top:3rem}"]})};export{K as BlogDetailComponent};
