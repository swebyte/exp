import{a as z}from"./chunk-W3XN5HZT.js";import{e as D,h as R}from"./chunk-RYWR7QYE.js";import{A as L,B as H,k as T,m as f,r as p,s as N,u as W,v as q,w as A,x as V,y as $,z as j}from"./chunk-DU5L4OSH.js";import{Bb as c,Jb as C,Lb as s,Mb as y,Na as a,Nb as U,Pb as v,Qb as M,Rb as w,Y as B,a as b,ab as k,b as u,ba as m,ga as S,ha as x,kb as _,lb as P,ob as E,pb as n,q as h,qb as l,rb as O,vb as I,ya as F,zb as g}from"./chunk-ZTWUCJV6.js";function K(i,o){if(i&1&&(n(0,"div",4),s(1),l()),i&2){let t=c();a(),y(t.errorMessage)}}function Q(i,o){if(i&1){let t=I();n(0,"textarea",18),w("ngModelChange",function(r){S(t);let d=c();return M(d.body,r)||(d.body=r),x(r)}),l()}if(i&2){let t=c();v("ngModel",t.body)}}function X(i,o){if(i&1&&(n(0,"div",14),O(1,"markdown",19),l()),i&2){let t=c();a(),E("data",t.body||"*No content yet*")}}var G=class i{activeModal=m(R);platformId=m(F);isBrowser=T(this.platformId);http=m(f);authService=m(N);blogPost;title="";body="";errorMessage="";showPreview=!1;get isEditMode(){return!!this.blogPost}ngOnInit(){this.blogPost&&(this.title=this.blogPost.title,this.body=this.blogPost.body)}onImageUploaded(o){let t=`
<img src="${o}" alt="Image" width="600">
`;this.body=this.body+t}onSubmit(){let o=this.authService.getUserId();if(!o){this.errorMessage="You must be logged in to create/edit posts";return}let t={title:this.title,body:this.body};if(this.isEditMode&&this.blogPost)this.http.patch(`${p.apiBaseUrl}/blog?id=eq.${this.blogPost.id}`,t).subscribe({next:e=>{console.log("Blog post updated:",e),this.activeModal.close(e)},error:e=>{console.error("Failed to update blog post:",e),this.errorMessage="Failed to update blog post. Please try again."}});else{let e=u(b({},t),{user_id:o});this.http.post(`${p.apiBaseUrl}/blog`,e).subscribe({next:r=>{console.log("Blog post created:",r),this.activeModal.close(r)},error:r=>{console.error("Failed to create blog post:",r),this.errorMessage="Failed to create blog post. Please try again."}})}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-blog-form"]],inputs:{blogPost:"blogPost"},decls:27,vars:13,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"alert","alert-danger"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","name","title","placeholder","Enter blog post title","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","body",1,"form-label"],[3,"imageUploaded"],[1,"d-flex","gap-2","mb-2"],["type","button",1,"btn","btn-sm",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModel"],[1,"border","rounded","p-3",2,"min-height","400px","background-color","#fff"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"data"]],template:function(t,e){t&1&&(n(0,"div",0)(1,"h5",1),s(2),l(),n(3,"button",2),g("click",function(){return e.activeModal.dismiss()}),l()(),n(4,"div",3),_(5,K,2,1,"div",4),n(6,"form",5),g("ngSubmit",function(){return e.onSubmit()}),n(7,"div",6)(8,"label",7),s(9,"Title"),l(),n(10,"input",8),w("ngModelChange",function(d){return M(e.title,d)||(e.title=d),d}),l()(),n(11,"div",6)(12,"label",9),s(13,"Content (Markdown supported)"),l(),n(14,"app-image-upload",10),g("imageUploaded",function(d){return e.onImageUploaded(d)}),l(),n(15,"div",11)(16,"button",12),g("click",function(){return e.showPreview=!1}),s(17," Edit "),l(),n(18,"button",12),g("click",function(){return e.showPreview=!0}),s(19," Preview "),l()(),_(20,Q,1,1,"textarea",13)(21,X,2,1,"div",14),l(),n(22,"div",15)(23,"button",16),s(24),l(),n(25,"button",17),g("click",function(){return e.activeModal.dismiss()}),s(26," Cancel "),l()()()()),t&2&&(a(2),y(e.isEditMode?"Edit Blog Post":"New Blog Post"),a(3),P(e.errorMessage?5:-1),a(5),v("ngModel",e.title),a(6),C("btn-primary",!e.showPreview)("btn-outline-primary",e.showPreview),a(2),C("btn-primary",e.showPreview)("btn-outline-primary",!e.showPreview),a(2),P(e.showPreview?21:20),a(4),U(" ",e.isEditMode?"Update Post":"Publish"," "))},dependencies:[H,j,W,q,A,L,$,V,D,z],styles:[".modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{font-weight:600}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #007bff40}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:200px}"]})};var Y=class i{http=m(f);getBlogPosts(){return this.http.get(`${p.apiBaseUrl}/blog?order=created_at.desc&select=*,users(fullname)`).pipe(h(o=>o.map(t=>u(b({},t),{author:t.users?.fullname||"Unknown Author"}))))}getBlogPost(o){return this.http.get(`${p.apiBaseUrl}/blog?id=eq.${o}&select=*,users(fullname)`).pipe(h(t=>{if(t.length>0){let e=t[0];return e.author=e.users?.fullname||"Unknown Author",e}return null}))}deleteBlogPost(o){return this.http.delete(`${p.apiBaseUrl}/blog?id=eq.${o}`)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=B({token:i,factory:i.\u0275fac,providedIn:"root"})};export{G as a,Y as b};
