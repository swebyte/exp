import{a as de}from"./chunk-SJQ2B3S3.js";import{e as Z,h as ae}from"./chunk-STM5T3Q6.js";import{A as re,B as le,C as se,l as C,n as L,s as c,t as X,v as ee,w as te,x as oe,y as ie,z as ne}from"./chunk-6RF4LEQF.js";import{Cb as g,D as _,Db as R,Eb as y,K as U,Mb as P,Na as a,Ob as m,Pb as M,Qb as H,Sb as J,T as S,Tb as Y,Ub as K,Vb as Q,Y as B,a as u,ab as I,b,ba as d,ec as T,ga as $,gc as F,ha as q,kb as j,lb as E,m as f,mb as N,oa as p,pb as v,q as h,qb as r,rb as l,sb as x,tb as D,ub as W,vb as V,ya as w,yb as z,zb as G}from"./chunk-6ZM7RP27.js";var k=class n{http=d(L);_posts=p([]);_selectedPost=p(null);posts=T(()=>this._posts());selectedPost=T(()=>this._selectedPost());loadBlogPosts(){this.http.get(`${c.apiBaseUrl}/blog?order=created_at.desc&select=*,users(fullname)`).pipe(h(o=>o.map(e=>b(u({},e),{author:e.users?.fullname||"Unknown Author"}))),_(o=>(console.error("Failed to load blog posts:",o),f([])))).subscribe(o=>this._posts.set(o))}loadBlogPost(o){return this.http.get(`${c.apiBaseUrl}/blog?id=eq.${o}&select=*,users(fullname)`).pipe(h(e=>{if(e.length>0){let t=e[0];return t.author=t.users?.fullname||"Unknown Author",t}return null}),S(e=>this._selectedPost.set(e)),_(e=>(console.error("Failed to load blog post:",e),this._selectedPost.set(null),f(null))))}deleteBlogPost(o){return this.http.delete(`${c.apiBaseUrl}/blog?id=eq.${o}`)}incrementBlogLikes(o){return this.http.post(`${c.apiBaseUrl}/rpc/inc_blog_likes`,{blog_id:o}).pipe(h(e=>e&&e.length>0?e[0].likes:null),S(e=>{if(e==null)return;this._posts.update(i=>i.map(s=>s.id===o?b(u({},s),{likes:e}):s));let t=this._selectedPost();t&&t.id===o&&this._selectedPost.set(b(u({},t),{likes:e}))}),_(e=>(console.error("Failed to increment likes:",e),f(null))))}decrementBlogLikes(o){return this.http.post(`${c.apiBaseUrl}/rpc/dec_blog_likes`,{blog_id:o}).pipe(h(e=>e&&e.length>0?e[0].likes:null),S(e=>{if(e==null)return;this._posts.update(i=>i.map(s=>s.id===o?b(u({},s),{likes:e}):s));let t=this._selectedPost();t&&t.id===o&&this._selectedPost.set(b(u({},t),{likes:e}))}),_(e=>(console.error("Failed to decrement likes:",e),f(null))))}generateAI(o){return o?this.http.post(`${c.apiBaseUrl}/b2/ask`,{Message:o}).pipe(h(e=>e&&e.result?e.result:null),_(e=>(console.error("AI generation failed:",e),f(null)))):f(null)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=B({token:n,factory:n.\u0275fac,providedIn:"root"})};var O=class n{blogService=d(k);platformId=d(w);likedPostsStore=p(new Set);constructor(){this.loadLikedPostsFromStorage()}loadLikedPostsFromStorage(){if(C(this.platformId)){let o=localStorage.getItem("likedPosts");if(o){let e=JSON.parse(o);this.likedPostsStore.set(new Set(e))}}}saveLikedPostsToStorage(){if(C(this.platformId)){let o=Array.from(this.likedPostsStore());localStorage.setItem("likedPosts",JSON.stringify(o))}}isPostLiked(o){return this.likedPostsStore().has(o)}toggleLike(o){let e=new Set(this.likedPostsStore());return e.has(o)?(e.delete(o),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.decrementBlogLikes(o).subscribe({next:i=>{console.log("Likes decremented on server, new count:",i)},error:i=>{console.error("Failed to decrement likes:",i)}}),{liked:!1}):(e.add(o),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.blogService.incrementBlogLikes(o).subscribe({next:i=>{console.log("Likes incremented on server, new count:",i)},error:i=>{console.error("Failed to increment likes:",i)}}),{liked:!0})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=B({token:n,factory:n.\u0275fac,providedIn:"root"})};var me=class n{likesService=d(O);postId=F.required();count=F.required();readonly=F(!1);liked=p(!1);ngOnInit(){this.liked.set(this.likesService.isPostLiked(this.postId()))}toggleLike(){if(this.readonly())return;let o=this.likesService.toggleLike(this.postId());this.liked.set(o.liked)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-like-button"]],inputs:{postId:[1,"postId"],count:[1,"count"],readonly:[1,"readonly"]},decls:4,vars:10,consts:[[1,"like-button",3,"click","title","disabled"],[1,"bi"],[1,"likes-count"]],template:function(e,t){e&1&&(D(0,"button",0),R("click",function(){return t.toggleLike()}),V(1,"i",1),D(2,"span",2),m(3),W()()),e&2&&(P("animated",!t.readonly()),G("title",Q("",t.liked()?"Unlike":"Like"," this post"))("disabled",t.readonly()),a(),P("bi-heart-fill",t.liked())("bi-heart",!t.liked()),a(2),M(t.count()))},styles:[".like-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;display:flex;align-items:center;gap:.5rem;color:#dc3545;font-size:1.25rem}.like-button.animated[_ngcontent-%COMP%]{transition:transform .2s ease}.like-button.animated[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.like-button.animated[_ngcontent-%COMP%]:active{transform:scale(.95)}.like-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}.like-button[_ngcontent-%COMP%]   .likes-count[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#6c757d}"]})};function ge(n,o){if(n&1&&(r(0,"div",4),m(1),l()),n&2){let e=y();a(),M(e.errorMessage)}}function ue(n,o){if(n&1){let e=z();r(0,"textarea",20),g("ngModelChange",function(i){$(e);let s=y();return q(s.body.set(i))}),l()}if(n&2){let e=y();v("ngModel",e.body())}}function be(n,o){if(n&1&&(r(0,"div",16),x(1,"markdown",21),l()),n&2){let e=y();a(),v("data",e.body()||"*No content yet*")}}var ce=class n{activeModal=d(ae);platformId=d(w);isBrowser=C(this.platformId);http=d(L);authService=d(X);blogService=d(k);blogPost;title="";body=p("");errorMessage="";showPreview=!1;aiLoading=!1;get isEditMode(){return!!this.blogPost}ngOnInit(){this.blogPost&&(this.title=this.blogPost.title,this.body.set(this.blogPost.body))}onImageUploaded(o){let e=`
<img src="${o}" alt="Image" width="600">
`;this.body.update(t=>t+e)}onAIGenerate(){this.errorMessage="";let o=`Make my blog post better and correct grammar:

${this.body()}

`;this.aiLoading=!0,this.blogService.generateAI(o).pipe(U(()=>this.aiLoading=!1)).subscribe(e=>{e?this.body.update(t=>e):this.errorMessage="AI generation failed. Please try again."})}onSubmit(){let o=this.authService.getUserId();if(!o){this.errorMessage="You must be logged in to create/edit posts";return}let e={title:this.title,body:this.body()};if(this.isEditMode&&this.blogPost)this.http.patch(`${c.apiBaseUrl}/blog?id=eq.${this.blogPost.id}`,e).subscribe({next:t=>{console.log("Blog post updated:",t),this.activeModal.close(t)},error:t=>{console.error("Failed to update blog post:",t),this.errorMessage="Failed to update blog post. Please try again."}});else{let t=b(u({},e),{user_id:o});this.http.post(`${c.apiBaseUrl}/blog`,t).subscribe({next:i=>{console.log("Blog post created:",i),this.activeModal.close(i)},error:i=>{console.error("Failed to create blog post:",i),this.errorMessage="Failed to create blog post. Please try again."}})}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-blog-form"]],inputs:{blogPost:"blogPost"},decls:30,vars:16,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"alert","alert-danger"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","name","title","placeholder","Enter blog post title","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","body",1,"form-label"],[3,"imageUploaded"],[1,"d-flex","gap-2","mb-2"],["type","button",1,"btn","btn-sm",3,"click"],["type","button","title","Generate content with AI","aria-label","Generate content with AI",1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1",3,"hidden"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModel"],[1,"border","rounded","p-3",2,"min-height","400px","background-color","#fff"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"data"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h5",1),m(2),l(),r(3,"button",2),g("click",function(){return t.activeModal.dismiss()}),l()(),r(4,"div",3),E(5,ge,2,1,"div",4),r(6,"form",5),g("ngSubmit",function(){return t.onSubmit()}),r(7,"div",6)(8,"label",7),m(9,"Title"),l(),r(10,"input",8),K("ngModelChange",function(s){return Y(t.title,s)||(t.title=s),s}),l()(),r(11,"div",6)(12,"label",9),m(13,"Content (Markdown supported)"),l(),r(14,"app-image-upload",10),g("imageUploaded",function(s){return t.onImageUploaded(s)}),l(),r(15,"div",11)(16,"button",12),g("click",function(){return t.showPreview=!1}),m(17," Edit "),l(),r(18,"button",12),g("click",function(){return t.showPreview=!0}),m(19," Preview "),l(),r(20,"button",13),g("click",function(){return t.onAIGenerate()}),x(21,"span",14),m(22," AI "),l()(),E(23,ue,1,1,"textarea",15)(24,be,2,1,"div",16),l(),r(25,"div",17)(26,"button",18),m(27),l(),r(28,"button",19),g("click",function(){return t.activeModal.dismiss()}),m(29," Cancel "),l()()()()),e&2&&(a(2),M(t.isEditMode?"Edit Blog Post":"New Blog Post"),a(3),N(t.errorMessage?5:-1),a(5),J("ngModel",t.title),a(6),P("btn-primary",!t.showPreview)("btn-outline-primary",t.showPreview),a(2),P("btn-primary",t.showPreview)("btn-outline-primary",!t.showPreview),a(2),v("disabled",t.aiLoading),j("aria-busy",t.aiLoading),a(),v("hidden",!t.aiLoading),a(2),N(t.showPreview?24:23),a(4),H(" ",t.isEditMode?"Update Post":"Publish"," "))},dependencies:[se,re,ee,te,oe,le,ne,ie,Z,de],styles:[".modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{font-weight:600}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #007bff40}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:200px}"]})};export{k as a,me as b,ce as c};
