import{a as oe}from"./chunk-IYCZIFL5.js";import{e as R,h as te}from"./chunk-ZZBXHBLD.js";import{A as Z,B as ee,k,m as u,r as p,s as H,u as J,v as G,w as Y,x as K,y as Q,z as X}from"./chunk-HGW3F55W.js";import{Ab as $,Bb as f,Jb as g,Lb as m,Mb as h,Na as s,Nb as V,Pb as L,Qb as F,Rb as x,Sb as z,Y as v,a as _,ab as y,b as P,ba as d,cc as M,ga as N,ha as D,kb as B,lb as I,oa as b,ob as T,pb as r,q as S,qb as l,rb as U,sb as O,tb as q,ub as A,vb as j,wb as W,ya as C,zb as c}from"./chunk-ZTWUCJV6.js";var w=class i{http=d(u);platformId=d(C);likedPostsStore=b(new Set);constructor(){this.loadLikedPostsFromStorage()}loadLikedPostsFromStorage(){if(k(this.platformId)){let o=localStorage.getItem("likedPosts");if(o){let t=JSON.parse(o);this.likedPostsStore.set(new Set(t))}}}saveLikedPostsToStorage(){if(k(this.platformId)){let o=Array.from(this.likedPostsStore());localStorage.setItem("likedPosts",JSON.stringify(o))}}isPostLiked(o){return this.likedPostsStore().has(o)}toggleLike(o,t){let e=new Set(this.likedPostsStore()),n=e.has(o),a;return n?(e.delete(o),a=Math.max(0,t-1)):(e.add(o),a=t+1),this.likedPostsStore.set(e),this.saveLikedPostsToStorage(),this.updateLikesOnServer(o,a),{liked:!n,newCount:a}}updateLikesOnServer(o,t){this.http.patch(`${p.apiBaseUrl}/blog?id=eq.${o}`,{likes:t}).subscribe({next:()=>{console.log("Likes updated on server")},error:e=>{console.error("Failed to update likes:",e)}})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})};var ie=class i{likesService=d(w);postId=M.required();initialLikesCount=M.required();readonly=M(!1);liked=b(!1);likesCount=b(0);ngOnInit(){this.likesCount.set(this.initialLikesCount()),this.liked.set(this.likesService.isPostLiked(this.postId()))}toggleLike(){if(this.readonly())return;let o=this.likesService.toggleLike(this.postId(),this.likesCount());this.liked.set(o.liked),this.likesCount.set(o.newCount)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=y({type:i,selectors:[["app-like-button"]],inputs:{postId:[1,"postId"],initialLikesCount:[1,"initialLikesCount"],readonly:[1,"readonly"]},decls:4,vars:10,consts:[[1,"like-button",3,"click","title","disabled"],[1,"bi"],[1,"likes-count"]],template:function(t,e){t&1&&(O(0,"button",0),$("click",function(){return e.toggleLike()}),A(1,"i",1),O(2,"span",2),m(3),q()()),t&2&&(g("animated",!e.readonly()),W("title",z("",e.liked()?"Unlike":"Like"," this post"))("disabled",e.readonly()),s(),g("bi-heart-fill",e.liked())("bi-heart",!e.liked()),s(2),h(e.likesCount()))},styles:[".like-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;display:flex;align-items:center;gap:.5rem;color:#dc3545;font-size:1.25rem}.like-button.animated[_ngcontent-%COMP%]{transition:transform .2s ease}.like-button.animated[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.like-button.animated[_ngcontent-%COMP%]:active{transform:scale(.95)}.like-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}.like-button[_ngcontent-%COMP%]   .likes-count[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#6c757d}"]})};var ne=class i{http=d(u);getBlogPosts(){return this.http.get(`${p.apiBaseUrl}/blog?order=created_at.desc&select=*,users(fullname)`).pipe(S(o=>o.map(t=>P(_({},t),{author:t.users?.fullname||"Unknown Author"}))))}getBlogPost(o){return this.http.get(`${p.apiBaseUrl}/blog?id=eq.${o}&select=*,users(fullname)`).pipe(S(t=>{if(t.length>0){let e=t[0];return e.author=e.users?.fullname||"Unknown Author",e}return null}))}deleteBlogPost(o){return this.http.delete(`${p.apiBaseUrl}/blog?id=eq.${o}`)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})};function ae(i,o){if(i&1&&(r(0,"div",4),m(1),l()),i&2){let t=f();s(),h(t.errorMessage)}}function se(i,o){if(i&1){let t=j();r(0,"textarea",18),x("ngModelChange",function(n){N(t);let a=f();return F(a.body,n)||(a.body=n),D(n)}),l()}if(i&2){let t=f();L("ngModel",t.body)}}function de(i,o){if(i&1&&(r(0,"div",14),U(1,"markdown",19),l()),i&2){let t=f();s(),T("data",t.body||"*No content yet*")}}var re=class i{activeModal=d(te);platformId=d(C);isBrowser=k(this.platformId);http=d(u);authService=d(H);blogPost;title="";body="";errorMessage="";showPreview=!1;get isEditMode(){return!!this.blogPost}ngOnInit(){this.blogPost&&(this.title=this.blogPost.title,this.body=this.blogPost.body)}onImageUploaded(o){let t=`
<img src="${o}" alt="Image" width="600">
`;this.body=this.body+t}onSubmit(){let o=this.authService.getUserId();if(!o){this.errorMessage="You must be logged in to create/edit posts";return}let t={title:this.title,body:this.body};if(this.isEditMode&&this.blogPost)this.http.patch(`${p.apiBaseUrl}/blog?id=eq.${this.blogPost.id}`,t).subscribe({next:e=>{console.log("Blog post updated:",e),this.activeModal.close(e)},error:e=>{console.error("Failed to update blog post:",e),this.errorMessage="Failed to update blog post. Please try again."}});else{let e=P(_({},t),{user_id:o});this.http.post(`${p.apiBaseUrl}/blog`,e).subscribe({next:n=>{console.log("Blog post created:",n),this.activeModal.close(n)},error:n=>{console.error("Failed to create blog post:",n),this.errorMessage="Failed to create blog post. Please try again."}})}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=y({type:i,selectors:[["app-blog-form"]],inputs:{blogPost:"blogPost"},decls:27,vars:13,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"alert","alert-danger"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","name","title","placeholder","Enter blog post title","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","body",1,"form-label"],[3,"imageUploaded"],[1,"d-flex","gap-2","mb-2"],["type","button",1,"btn","btn-sm",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModel"],[1,"border","rounded","p-3",2,"min-height","400px","background-color","#fff"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"data"]],template:function(t,e){t&1&&(r(0,"div",0)(1,"h5",1),m(2),l(),r(3,"button",2),c("click",function(){return e.activeModal.dismiss()}),l()(),r(4,"div",3),B(5,ae,2,1,"div",4),r(6,"form",5),c("ngSubmit",function(){return e.onSubmit()}),r(7,"div",6)(8,"label",7),m(9,"Title"),l(),r(10,"input",8),x("ngModelChange",function(a){return F(e.title,a)||(e.title=a),a}),l()(),r(11,"div",6)(12,"label",9),m(13,"Content (Markdown supported)"),l(),r(14,"app-image-upload",10),c("imageUploaded",function(a){return e.onImageUploaded(a)}),l(),r(15,"div",11)(16,"button",12),c("click",function(){return e.showPreview=!1}),m(17," Edit "),l(),r(18,"button",12),c("click",function(){return e.showPreview=!0}),m(19," Preview "),l()(),B(20,se,1,1,"textarea",13)(21,de,2,1,"div",14),l(),r(22,"div",15)(23,"button",16),m(24),l(),r(25,"button",17),c("click",function(){return e.activeModal.dismiss()}),m(26," Cancel "),l()()()()),t&2&&(s(2),h(e.isEditMode?"Edit Blog Post":"New Blog Post"),s(3),I(e.errorMessage?5:-1),s(5),L("ngModel",e.title),s(6),g("btn-primary",!e.showPreview)("btn-outline-primary",e.showPreview),s(2),g("btn-primary",e.showPreview)("btn-outline-primary",!e.showPreview),s(2),I(e.showPreview?21:20),s(4),V(" ",e.isEditMode?"Update Post":"Publish"," "))},dependencies:[ee,X,J,G,Y,Z,Q,K,R,oe],styles:[".modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{font-weight:600}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #007bff40}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:200px}"]})};export{ie as a,ne as b,re as c};
