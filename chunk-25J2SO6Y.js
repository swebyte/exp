import{a as ee}from"./chunk-SJQ2B3S3.js";import{e as j,h as Z}from"./chunk-STM5T3Q6.js";import{A as K,B as Q,C as X,l as V,n as M,s as m,t as G,v as z,w as H,x as R,y as Y,z as J}from"./chunk-6RF4LEQF.js";import{Cb as p,D as f,Eb as v,K as E,Mb as k,Na as s,Ob as d,Pb as F,Qb as $,Sb as L,T as y,Tb as q,Ub as W,Y as I,a as g,ab as A,b as c,ba as u,ec as x,ga as O,ha as U,kb as D,lb as B,m as b,mb as w,oa as _,pb as P,q as h,qb as i,rb as r,sb as S,ya as N,yb as T}from"./chunk-6ZM7RP27.js";var C=class l{http=u(M);_posts=_([]);_selectedPost=_(null);posts=x(()=>this._posts());selectedPost=x(()=>this._selectedPost());loadBlogPosts(){this.http.get(`${m.apiBaseUrl}/blog?order=created_at.desc&select=*,users(fullname)`).pipe(h(o=>o.map(e=>c(g({},e),{author:e.users?.fullname||"Unknown Author"}))),f(o=>(console.error("Failed to load blog posts:",o),b([])))).subscribe(o=>this._posts.set(o))}loadBlogPost(o){return this.http.get(`${m.apiBaseUrl}/blog?id=eq.${o}&select=*,users(fullname)`).pipe(h(e=>{if(e.length>0){let t=e[0];return t.author=t.users?.fullname||"Unknown Author",t}return null}),y(e=>this._selectedPost.set(e)),f(e=>(console.error("Failed to load blog post:",e),this._selectedPost.set(null),b(null))))}deleteBlogPost(o){return this.http.delete(`${m.apiBaseUrl}/blog?id=eq.${o}`)}incrementBlogLikes(o){return this.http.post(`${m.apiBaseUrl}/rpc/inc_blog_likes`,{blog_id:o}).pipe(h(e=>e&&e.length>0?e[0].likes:null),y(e=>{if(e==null)return;this._posts.update(n=>n.map(a=>a.id===o?c(g({},a),{likes:e}):a));let t=this._selectedPost();t&&t.id===o&&this._selectedPost.set(c(g({},t),{likes:e}))}),f(e=>(console.error("Failed to increment likes:",e),b(null))))}decrementBlogLikes(o){return this.http.post(`${m.apiBaseUrl}/rpc/dec_blog_likes`,{blog_id:o}).pipe(h(e=>e&&e.length>0?e[0].likes:null),y(e=>{if(e==null)return;this._posts.update(n=>n.map(a=>a.id===o?c(g({},a),{likes:e}):a));let t=this._selectedPost();t&&t.id===o&&this._selectedPost.set(c(g({},t),{likes:e}))}),f(e=>(console.error("Failed to decrement likes:",e),b(null))))}generateAI(o){return o?this.http.post(`${m.apiBaseUrl}/b2/ask`,{Message:o}).pipe(h(e=>e&&e.message?e.message:null),f(e=>(console.error("AI generation failed:",e),b(null)))):b(null)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=I({token:l,factory:l.\u0275fac,providedIn:"root"})};function ne(l,o){if(l&1&&(i(0,"div",4),d(1),r()),l&2){let e=v();s(),F(e.errorMessage)}}function ie(l,o){if(l&1){let e=T();i(0,"textarea",20),p("ngModelChange",function(n){O(e);let a=v();return U(a.body.set(n))}),r()}if(l&2){let e=v();P("ngModel",e.body())}}function re(l,o){if(l&1&&(i(0,"div",16),S(1,"markdown",21),r()),l&2){let e=v();s(),P("data",e.body()||"*No content yet*")}}var te=class l{activeModal=u(Z);platformId=u(N);isBrowser=V(this.platformId);http=u(M);authService=u(G);blogService=u(C);blogPost;title="";body=_("");errorMessage="";showPreview=!1;aiLoading=!1;get isEditMode(){return!!this.blogPost}ngOnInit(){this.blogPost&&(this.title=this.blogPost.title,this.body.set(this.blogPost.body))}onImageUploaded(o){let e=`
<img src="${o}" alt="Image" width="600">
`;this.body.update(t=>t+e)}onAIGenerate(){this.errorMessage="";let o=`Make my blog post better and correct grammar. Only return actaul changed text.:

${this.body()}

`;this.aiLoading=!0,this.blogService.generateAI(o).pipe(E(()=>this.aiLoading=!1)).subscribe(e=>{if(e===null){this.errorMessage="AI generation failed. Please try again.";return}console.log(e),this.body.update(t=>e)})}onSubmit(){let o=this.authService.getUserId();if(!o){this.errorMessage="You must be logged in to create/edit posts";return}let e={title:this.title,body:this.body()};if(this.isEditMode&&this.blogPost)this.http.patch(`${m.apiBaseUrl}/blog?id=eq.${this.blogPost.id}`,e).subscribe({next:t=>{console.log("Blog post updated:",t),this.activeModal.close(t)},error:t=>{console.error("Failed to update blog post:",t),this.errorMessage="Failed to update blog post. Please try again."}});else{let t=c(g({},e),{user_id:o});this.http.post(`${m.apiBaseUrl}/blog`,t).subscribe({next:n=>{console.log("Blog post created:",n),this.activeModal.close(n)},error:n=>{console.error("Failed to create blog post:",n),this.errorMessage="Failed to create blog post. Please try again."}})}}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=A({type:l,selectors:[["app-blog-form"]],inputs:{blogPost:"blogPost"},decls:30,vars:16,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"alert","alert-danger"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","name","title","placeholder","Enter blog post title","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","body",1,"form-label"],[3,"imageUploaded"],[1,"d-flex","gap-2","mb-2"],["type","button",1,"btn","btn-sm",3,"click"],["type","button","title","Generate content with AI","aria-label","Generate content with AI",1,"btn","btn-sm","btn-outline-primary","ms-auto",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1","text-dark",3,"hidden"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModel"],[1,"border","rounded","p-3",2,"min-height","400px","background-color","#fff"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],["id","body","name","body","rows","15","placeholder","Write your blog post content here... (Markdown supported)","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"data"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"h5",1),d(2),r(),i(3,"button",2),p("click",function(){return t.activeModal.dismiss()}),r()(),i(4,"div",3),B(5,ne,2,1,"div",4),i(6,"form",5),p("ngSubmit",function(){return t.onSubmit()}),i(7,"div",6)(8,"label",7),d(9,"Title"),r(),i(10,"input",8),W("ngModelChange",function(a){return q(t.title,a)||(t.title=a),a}),r()(),i(11,"div",6)(12,"label",9),d(13,"Content (Markdown supported)"),r(),i(14,"app-image-upload",10),p("imageUploaded",function(a){return t.onImageUploaded(a)}),r(),i(15,"div",11)(16,"button",12),p("click",function(){return t.showPreview=!1}),d(17," Edit "),r(),i(18,"button",12),p("click",function(){return t.showPreview=!0}),d(19," Preview "),r(),i(20,"button",13),p("click",function(){return t.onAIGenerate()}),S(21,"span",14),d(22," AI "),r()(),B(23,ie,1,1,"textarea",15)(24,re,2,1,"div",16),r(),i(25,"div",17)(26,"button",18),d(27),r(),i(28,"button",19),p("click",function(){return t.activeModal.dismiss()}),d(29," Cancel "),r()()()()),e&2&&(s(2),F(t.isEditMode?"Edit Blog Post":"New Blog Post"),s(3),w(t.errorMessage?5:-1),s(5),L("ngModel",t.title),s(6),k("btn-primary",!t.showPreview)("btn-outline-primary",t.showPreview),s(2),k("btn-primary",t.showPreview)("btn-outline-primary",!t.showPreview),s(2),P("disabled",t.aiLoading),D("aria-busy",t.aiLoading),s(),P("hidden",!t.aiLoading),s(2),w(t.showPreview?24:23),s(4),$(" ",t.isEditMode?"Update Post":"Publish"," "))},dependencies:[X,K,z,H,R,Q,J,Y,j,ee],styles:[".modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{font-weight:600}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #007bff40}.modal-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:200px}"]})};export{C as a,te as b};
